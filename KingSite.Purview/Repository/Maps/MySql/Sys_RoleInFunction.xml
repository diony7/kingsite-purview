<?xml version="1.0" encoding="utf-8" ?>
<!--============================================================================
//	CAUTION: This file is generated by BatisMap.cst at 2011-01-29 15:49:28
//				Any manual editing will be lost in re-generation.
//===========================================================================-->
<sqlMap namespace="Sys_RoleInFunction"
	xmlns="http://ibatis.apache.org/mapping"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

    <alias>
        <typeAlias alias="Sys_RoleInFunction" type="KingSite.Purview.Domain.Sys_RoleInFunction, KingSite.Purview" />
    </alias>

    <resultMaps>
        <resultMap id="FullResultMap" class="Sys_RoleInFunction">
            <result property="Id" column="Id"/>
            <result property="RoleId" column="RoleId"/>
            <result property="FunctionId" column="FunctionId"/>
        </resultMap>
    </resultMaps>

    <statements>

        <select id="GetCount" resultClass="System.Int32">
            SELECT count(*) FROM Sys_RoleInFunction
        </select>

        <select id="FindAll" resultMap="FullResultMap">
            SELECT *
            FROM Sys_RoleInFunction
        </select>

        <select id="Find" parameterClass="Sys_RoleInFunction" resultMap="FullResultMap" extends="FindAll">
            WHERE
            (Id = #Id#)
        </select>

        <select id="FindByRoleId" parameterClass="Int32" resultMap="FullResultMap" extends="FindAll">
            WHERE (RoleId = #value#)
        </select>
        <select id="FindByFunctionId" parameterClass="Int32" resultMap="FullResultMap" extends="FindAll">
            WHERE (FunctionId = #value#)
        </select>

        <select id="FindByRoleName" parameterClass="map" resultMap="FullResultMap">
            Select Distinct rif.* from Sys_RoleInFunction rif
            join Sys_Role r on r.Id = rif.RoleId
            where r.rolename in ($RoleNam$) and r.applicationname = #ApplicationName#
        </select>

        <select id="FindByUCA" parameterClass="map" resultMap="FullResultMap">
            SELECT DISTINCT rif. *
            FROM Sys_RoleInFunction rif
            JOIN Sys_Role r ON r.Id = rif.RoleId
            JOIN Sys_Function f ON f.Id = rif.FunctionId
            WHERE r.rolename
            IN (
                SELECT rolename
                FROM sys_userinrole
                WHERE Username = #UserName#
                AND applicationName = #ApplicationName#
            )
            AND r.applicationname = #ApplicationName#
            AND f.applicationName = #ApplicationName#
            AND f.ControllerName = #ControllerName#
            AND f.ActionName = #ActionName#
        </select>

        <insert id="Insert" parameterClass="Sys_RoleInFunction">
            INSERT INTO Sys_RoleInFunction (
            Id
            , RoleId
            , FunctionId
            ) VALUES (
            #Id#
            , #RoleId#
            , #FunctionId#
            )
        </insert>

        <update id="Update" parameterClass="Sys_RoleInFunction">
            UPDATE Sys_RoleInFunction SET
            RoleId = #RoleId#
            , FunctionId = #FunctionId#
            WHERE
            (Id = #Id#)
        </update>

        <delete id="Delete" parameterClass="Sys_RoleInFunction">
            DELETE FROM Sys_RoleInFunction
            WHERE
            (Id = #Id#)
        </delete>

        <delete id="DeleteByRoleId" parameterClass="Int32">
            DELETE FROM Sys_RoleInFunction WHERE (RoleId = #value#)
        </delete>
        <delete id="DeleteByFunctionId" parameterClass="Int32">
            DELETE FROM Sys_RoleInFunction WHERE (FunctionId = #value#)
        </delete>

        <select id="Reload" parameterClass="Sys_RoleInFunction" resultMap="FullResultMap" extends="FindAll">
            WHERE (Id = #Id#)
        </select>
    </statements>
</sqlMap>
